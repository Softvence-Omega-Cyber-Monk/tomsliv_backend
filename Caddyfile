api.farmlink.nz {
  tls internal # TODO: remove in production

  reverse_proxy /socket.io* api:3000

  @api {
    not path /socket.io*
  }

  handle @api {
    # Allow up to 500MB upload
    request_body {
      max_size 500MB
    }

    reverse_proxy api:3000 {
      header_up X-Real-IP {remote}
      header_up X-Forwarded-For {remote}
      header_up X-Forwarded-Proto {scheme}
      header_up Host {host}
    }
  }
}

farmlink.nz {
  tls internal # TODO: remove in production

  root * /var/www/html/dist
  try_files {path} /index.html
  file_server
  header {
    Cache-Control "public, max-age=31536000, immutable"
  }
  encode gzip
}